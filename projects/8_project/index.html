<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Modeling and verification of the quadrotor flight control system | Zhuo Zhi </title> <meta name="author" content="Zhuo Zhi"> <meta name="description" content="Bachelor's thesis"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?b05f9a0b7405d7c8c89c7465593dea81"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?dadeb9c5d1fd12bc8d37475657446863"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?53a094b51ed1d1e025731eb00d240058" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://zhuozhi-ucl.github.io/projects/8_project/"> <script src="/assets/js/theme.js?8c8262f54ac80beb3e456971f921ab9f"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?46af317e693b09921dcb92261d123fbc" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Zhuo</span> Zhi </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <article> <h1 id="modeling-and-verification-of-the-quadrotor-flight-control-system-bachelors-thesis-ieee-icsmd-2020">Modeling and verification of the quadrotor flight control system (Bachelor’s thesis, IEEE ICSMD 2020)</h1> <h2 id="introduction">Introduction</h2> <p>In order to improve the reliability of low-cost quadrotor UAV flight control system, designed a flight control system and proposed a modeling method. In this method, Newton-Euler formula is involved to set up the kinematic equation. The Mahony filter is used for sensor data fusion and attitude algorithm. A cascade proportion integration differentiation controller with integral separation is designed to control the attitude. Experimental data are compared between the simulation model and the real platform. The usability of the model is verified and the reliability of the real flight control system can be evaluated by the formulated model.</p> <h2 id="the-simulation-model">The simulation model</h2> <p>The model is built by Simulink in Matlab. The model mainly includes three sub-models, the attitude control model, the motor dynamics model and the rigid body dynamics model. The following is a brief introduction to the algorithms and principles used.</p> <h3 id="1-establishment-of-kinematic-equation">(1) Establishment of kinematic equation</h3> <p>The external forces and moments experienced by the quadrotor UAV include three items.</p> <ul> <li> <p>The gravity.</p> </li> <li> <p>Lift\({F_i} (i=1, 2, 3, 4)\) generated by rotation of rotors.</p> </li> <li> <p>Torsional\({M_i} (i=1, 2, 3, 4)\)produced by rotor rotation.</p> </li> </ul> <p>The linear motion equation is defined by</p> \[m\ddot r = \left[ \begin{array}{c} 0\\ 0\\ - mg \end{array} \right] + Rt\left[ \begin{array}{c} 0\\ 0\\ \sum \end{array} \right]\] <p>where \(r\) is position vector, \({F_i}\) is rotation lift, \(mg\) is the gravity, \(Rt\) is rotation matrix. And angular motion equation is given by</p> \[I\left[ \begin{array}{l} {\dot p}\\ {\dot q}\\ {\dot r} \end{array} \right]{\rm{ = }}\left[ \begin{array}{l} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} L({F_2}{\rm{ - }}{F_4})\\ {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} {\kern 1pt} L({F_3}{\rm{ - }}{F_1})\\ {M_1} - {M_2} + {M_3} - {M_4} \end{array} \right] - \left[ \begin{array}{l} p\\ q\\ r \end{array} \right] \times I\left[ \begin{array}{l} p\\ q\\ r \end{array} \right],\] <p>where \(L\) is distance from the rotor centre to the mass centre of UAV, \(I\) is inertia matrix, \(p\) , \(q\) and \(r\) are components of triaxial angular velocity in the body coordinate system.</p> <h3 id="2-mahony-filter">(2) Mahony filter</h3> <p>Mahony filter is utilized as attitude algorithm. The core idea is based on predictive-correction, given as follows.</p> <ul> <li>The standard gravity vector in the space coordinate system is converted into the body coordinate system by the rotation matrix. The process is shown by</li> </ul> \[\left[ {\begin{array}{*{20}{c}} {vx}\\ {vy}\\ {vz} \end{array}} \right] = \left[ {\begin{array}{*{20}{c}} {2(q2q2 + q3q3)}&amp;{2(q1q2 + q0q3)}&amp;{2(q1q3 - q0q2)}\\ {2(q1q2 - q0q3)}&amp;{1 - 2(q1q1 + q3q3)}&amp;{2(q2q3 + q0q1)}\\ {2(q1q3 + q0q2)}&amp;{2(q2q3 + q0q1)}&amp;{1 - 2(q1q1 + q2q2)} \end{array}} \right] \times \left[ \begin{array}{l} 0\\ 0\\ 1 \end{array} \right] =\] \[\left[ {\begin{array}{*{20}{c}} {2(q1q3 - q0q2)}\\ {2(q2q3 + q0q1)}\\ {1 - 2(q1q1 + q2q2)} \end{array}} \right]\] <p>where \([{v_x},{v_y},{v_z}]\) is the gravity vector. \([0,0,1]\) is the coefficient of the standard gravity vector. The \(q0\), \(q1\), \(q2\) and \(q3\) are used to form a quaternion.</p> <ul> <li>The error of the two coordinate systems is achieved by cross multiplication, which is used to correct the gyroscope in Mahony filter, as given by</li> </ul> \[\left[ \begin{array}{l} ex\\ ey\\ ez \end{array} \right] = \left[ \begin{array}{l} ax\\ ay\\ az \end{array} \right] \otimes \left[ \begin{array}{l} vx\\ vy\\ vz \end{array} \right] = \left[ {\begin{array}{*{20}{c}} \begin{array}{l} ay * vz - az * vy\\ az * vx - ax * vz \end{array}\\ {ax * vy - az * vx} \end{array}} \right]\] <p>where \(\left[ {{a_x},{a_y},{a_z}} \right]\) is the gravity vector measured by sensors, and \(\left[ {{e_x},{e_y},{e_z}} \right]\) is the error vector of two coordinate systems.</p> <ul> <li>The gyroscope is compensated and corrected by the error vector through a PI controller. The integral error of the gyroscope is the fundamental source of error in the body coordinate system.</li> </ul> <h3 id="3-cascade--pid-controller">(3) Cascade PID controller</h3> <p>A double-loop cascade PID controller with integral separation. Take the ROL angle as an example, the diagram of control block is shown below ：</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/PIDcontrol.PNG-480.webp 480w,/assets/img/project_image/project8/PIDcontrol.PNG-800.webp 800w,/assets/img/project_image/project8/PIDcontrol.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/PIDcontrol.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>When the deviation is large, the integral term is cleared. When the deviation is small, the integral term is turned on, which can achieve rapid dynamic response and stable static control.</p> <h2 id="flight-controller-design-software--hardware">Flight controller design( software &amp; hardware)</h2> <h3 id="1-software-design">(1) Software design</h3> <p>All software functions are divided into several tasks, such as upper computer communication, sensor data reading and processing, attitude solution, attitude control, external input capture, etc. Priorities are assigned to tasks. Timer interrupts are used as start flags for tasks. The flow chart of system software is shown blew：</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/software_design.PNG-480.webp 480w,/assets/img/project_image/project8/software_design.PNG-800.webp 800w,/assets/img/project_image/project8/software_design.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/software_design.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Several main tasks are analysed as follows.</p> <ul> <li>External input signal capture</li> </ul> <p>The external capture function of STM32F103RCT6 is used to decode the remote control signal as the input signal to the control system.</p> <ul> <li>Upper computer communication</li> </ul> <p>The Direct Memory Access (DMA) transmission mode is used for wireless communication. This method solves the problem that serial communication interferes with other task processes. It achieves high-speed data transmission and fast system control.</p> <ul> <li>Attitude algorithm and attitude control</li> </ul> <p>Mahony filter was used for attitude algorithm. First order complementary filter was utilized for height calculation. The final output of the attitude control is the motor control PWM amount, which contains five inputs, as shown below： </p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/OUTPUT.PNG-480.webp 480w,/assets/img/project_image/project8/OUTPUT.PNG-800.webp 800w,/assets/img/project_image/project8/OUTPUT.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/OUTPUT.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h3 id="2-hardware-design">(2) Hardware design</h3> <p>The MCU in this system is STM32F103RCT6. The sensors used are MPU9250 attitude sensor (with built-in gyroscope, accelerometer, magnetometer)(later improved to Mpu6050 + Ak8975), SPL06 barometer. The block diagram of hardware design is shown below：</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/Hardware_diagram.PNG-480.webp 480w,/assets/img/project_image/project8/Hardware_diagram.PNG-800.webp 800w,/assets/img/project_image/project8/Hardware_diagram.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/Hardware_diagram.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The first version of the drone , the improved PCB diagram and the schematic diagram of the flight controller is shown below:</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/feiji-480.webp 480w,/assets/img/project_image/project8/feiji-800.webp 800w,/assets/img/project_image/project8/feiji-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/feiji.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/pcb.PNG-480.webp 480w,/assets/img/project_image/project8/pcb.PNG-800.webp 800w,/assets/img/project_image/project8/pcb.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/pcb.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/yuanli.PNG-480.webp 480w,/assets/img/project_image/project8/yuanli.PNG-800.webp 800w,/assets/img/project_image/project8/yuanli.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/yuanli.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2 id="experiment">Experiment</h2> <h3 id="1-hight-control-experiment">(1) Hight control experiment</h3> <p>The test objective is to identify the effect of the variable height control. The height control instructions are shown below: </p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/gaoduzhilin.PNG-480.webp 480w,/assets/img/project_image/project8/gaoduzhilin.PNG-800.webp 800w,/assets/img/project_image/project8/gaoduzhilin.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/gaoduzhilin.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The height data measured in simulation model and real platform are shown below:</p> <div class="row"> <div class="col-sm-6 mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/gaoduduibi.PNG-480.webp 480w,/assets/img/project_image/project8/gaoduduibi.PNG-800.webp 800w,/assets/img/project_image/project8/gaoduduibi.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/gaoduduibi.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>The curve of height data measured in real platform has the same trend as the curve of height data measured in simulation model. The correlation coefficient between two data sets is <strong>0.9794</strong>, which indicates a strong relationship.</p> <h3 id="2-dynamic-attitude-control-experiment">(2) Dynamic attitude control experiment</h3> <p>The test objective is to study the overshoot, response speed and regression error. The desired angle input is set randomly. The angle data measured in simulation model and real platform are shown below:</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/duibi1.PNG-480.webp 480w,/assets/img/project_image/project8/duibi1.PNG-800.webp 800w,/assets/img/project_image/project8/duibi1.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/duibi1.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project8/duibi2.PNG-480.webp 480w,/assets/img/project_image/project8/duibi2.PNG-800.webp 800w,/assets/img/project_image/project8/duibi2.PNG-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project8/duibi2.PNG" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Experimental data of real platform can follow the simulated waveforms well, and no runaway or oscillation occurs. Due to sensor noise and unavoidable environmental factors, there are small glitches in the measured data. The control system is accompanied with overshoot, which does not exceed 1 degree. The regression error does not exceed 1 degree in the end of each instruction cycle. And the delay of controller response is less than 10ms. The correlation of three sets of comparative data are 0.9098, 0.9192, and 0.9688 respectively. Therefore, it can be considered that the output of simulation model and real platform in dynamic attitude control experiment is consistent.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Zhuo Zhi. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?b977fe0c21b2118ed853308b1b923969"></script> <script src="/assets/js/no_defer.js?e8a6dbd71fc764692f38fbf939656597"></script> <script defer src="/assets/js/common.js?9229ec218bee09057aa092a2813b1432"></script> <script defer src="/assets/js/copy_code.js?d359581efc54b08366f9ef8219e6e511" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?25eff8ff4144a010e4ad7b31403102cf"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>