<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> HgbNet: predicting hemoglobin level/anemia degree from EHR data | Zhuo Zhi </title> <meta name="author" content="Zhuo Zhi"> <meta name="description" content="https://arxiv.org/abs/2401.12002 (under review)"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?b05f9a0b7405d7c8c89c7465593dea81"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?dadeb9c5d1fd12bc8d37475657446863"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?53a094b51ed1d1e025731eb00d240058" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://zhuozhi-ucl.github.io/projects/4_project/"> <script src="/assets/js/theme.js?8c8262f54ac80beb3e456971f921ab9f"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?46af317e693b09921dcb92261d123fbc" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Zhuo</span> Zhi </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <article> <h1 id="hgbnet-predicting-hemoglobin-levelanemia-degree-from-ehr-data-under-review"> <a href="https://arxiv.org/abs/2401.12002" rel="external nofollow noopener" target="_blank">HgbNet: predicting hemoglobin level/anemia degree from EHR data</a> (under review)</h1> <h2 id="abstract">Abstract</h2> <p>Anemia is a prevalent medical condition that typically requires invasive blood tests for diagnosis and monitoring. Electronic health records (EHRs) have emerged as valuable data sources for numerous medical studies. EHR-based hemoglobin level/anemia degree prediction is non-invasive and rapid but still faces some challenges due to the fact that EHR data is typically an irregular multivariate time series containing a significant number of missing values and irregular time intervals. To address these issues, we introduce HgbNet, a machine learning-based prediction model that emulates clinicians’ decision-making processes for hemoglobin level/anemia degree prediction. The model incorporates a NanDense layer with a missing indicator to handle missing values and employs attention mechanisms to account for both local irregularity and global irregularity. We evaluate the proposed method using two real-world datasets across two use cases. In our first use case, we predict hemoglobin level/anemia degree at moment T+1 by utilizing records from moments prior to T+1. In our second use case, we integrate all historical records with additional selected test results at moment T+1 to predict hemoglobin level/anemia degree at the same moment, T+1. HgbNet outperforms the best baseline results across all datasets and use cases. These findings demonstrate the feasibility of estimating hemoglobin levels and anemia degree from EHR data, positioning HgbNet as an effective non-invasive anemia diagnosis solution that could potentially enhance the quality of life for millions of affected individuals worldwide. To our knowledge, HgbNet is the first machine learning model leveraging EHR data for hemoglobin level/anemia degree prediction.</p> <h2 id="overview">Overview</h2> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/1-480.webp 480w,/assets/img/project_image/project4/1-800.webp 800w,/assets/img/project_image/project4/1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> </div> <p>The structure of the proposed HgbNet. At each time step \(t\), the HgbNet input comprises four components: the original EHR data \(x_t\), the feature-specific time interval matrix \(e_t\), the missing indicator \(m_t\), and the label time interval matrix \(\delta_t\). The time embedding (TE) layer and NanDense layers process \(e_t\) and \(x_t\), respectively, before being input to the LSTM-M network alongside \(m_t\) to generate the hidden representation \(h_t\). Subsequently, \(\{h_1,h_2,...,h_T\}\) interacts with itself, \(\{\hat{e}_1,\hat{e}_2,...,\hat{e}_T\}\), and \(\{\delta_1,\delta_2,...,\delta_T\}\) to compute three attention types, accounting for each record’s interaction, local irregularity, and global irregularity. Finally, the fused hidden representation \(h_{\tau T}\), derived from the three attention results, is employed for downstream tasks to predict hemoglobin level and anemia degree at time step \(T+1\).</p> <h2 id="main-results">Main results</h2> <p>Our evaluation of the proposed model contains two datasets (Mimic III and eICU), two tasks (hemoglobin level/anemia degree prediction) and two use cases (use all historical data up to time T to forecast the value at T+1, or integrate select data available at T+1 with the historical data to predict the value at T+1). The main experimental results are presented below. The baseline we compare with are LSTM, T-LSTM, Data-GRU, ATTAIN, MIAM, HiTANet.</p> <h3 id="use-case-1">use case 1</h3> <p>Initially, we plot the predicted hemoglobin levels against their corresponding true values, as illustrated in the image below (samples are sorted by true value for easy observation). The evaluation matrix with corresponding standard deviation for hemoglobin level and anemia degree prediction are provided in tables.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/hgb_mimic-480.webp 480w,/assets/img/project_image/project4/hgb_mimic-800.webp 800w,/assets/img/project_image/project4/hgb_mimic-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/hgb_mimic.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The hemoglobin level prediction result of MIMIC III dataset. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/hgb_eicu-480.webp 480w,/assets/img/project_image/project4/hgb_eicu-800.webp 800w,/assets/img/project_image/project4/hgb_eicu-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/hgb_eicu.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The hemoglobin level prediction result of eICU dataset. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/hgb_matric-480.webp 480w,/assets/img/project_image/project4/hgb_matric-800.webp 800w,/assets/img/project_image/project4/hgb_matric-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/hgb_matric.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The evaluation matrix for hemoglobin level estimation. </div> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/anemia_matric-480.webp 480w,/assets/img/project_image/project4/anemia_matric-800.webp 800w,/assets/img/project_image/project4/anemia_matric-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/anemia_matric.jpg" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The evaluation matrix for anemia degree estimation. </div> <p>For hemoglobin level prediction, LSTM is the least effective, with the highest RMSE, MAE, and lowest R2 scores on both datasets. This deficiency can be attributed to the LSTM model’s inability to manage irregular time intervals and missing values. T-LSTM demonstrates improvement but underperforms compared to other baselines. This outcome can be explained by T-LSTM’s focus on irregular time intervals between visits while disregarding missing values. The remaining models display further advancements, with the proposed HgbNet attaining the lowest RMSE and MAE, as well as the highest R2 scores in both datasets. The improvements over the best metric from other baselines in the two datasets are 5.2\(\%\), 16.2\(\%\), 0.6\(\%\) and 19.5\(\%\), 6.4\(\%\), 1.9\(\%\). Concerning the Data-GRU, ATTAIN, MIAM, and HiTANet methods, the latter two yield marginally better results than the former two, possibly due to their incorporation of various attention types.</p> <p>For anemia degree prediction, generally, the results align with the hemoglobin prediction findings. LSTM and T-LSTM display limited capabilities, while other baselines exhibit improvement, with HgbNet showcasing the best performance. It achieves the highest weighted precision and weighted F1 scores in both datasets. Specifically, the improvements over the best results from other baselines amount to 2.8\(\%\), 1.3\(\%\), 0.2\(\%\), and 1.2\(\%\). In conclusion, all baseline models improve in handling irregular time series compared to traditional LSTM methods. Our proposed HgbNet consistently outperforms existing methods for both tasks across the two datasets, showcasing its superior performance.</p> <p>We also analyze the effect of irregular time intervals on model performance. In practice, the interval between moments \(T\) and \(T+1\) is indeterminate (i.e., the patient’s last diagnosis result could have been hours or days ago), and excessively large intervals may render predictions unreliable. We now aim to explore this issue further.</p> <p>Due to space constraints, we employ R2 scores and F1 scores as evaluation metrics for two tasks, respectively. The prediction results under irregular time intervals for MIMIC III dataset are presented below.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/interval_r2-480.webp 480w,/assets/img/project_image/project4/interval_r2-800.webp 800w,/assets/img/project_image/project4/interval_r2-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/interval_r2.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="example image" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_image/project4/interval_f1-480.webp 480w,/assets/img/project_image/project4/interval_f1-800.webp 800w,/assets/img/project_image/project4/interval_f1-1400.webp 1400w," sizes="95vw" type="image/webp"></source> <img src="/assets/img/project_image/project4/interval_f1.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> The matric of hemoglobin level and anemia degree prediction for MIMIC III dataset at different time intervals between T and T+1. </div> <h3 id="use-case-2">use case 2</h3> <p>Due to the limited space, please check the <a href="https://arxiv.org/abs/2401.12002" rel="external nofollow noopener" target="_blank">paper</a> for more results.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Zhuo Zhi. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?b977fe0c21b2118ed853308b1b923969"></script> <script src="/assets/js/no_defer.js?e8a6dbd71fc764692f38fbf939656597"></script> <script defer src="/assets/js/common.js?9229ec218bee09057aa092a2813b1432"></script> <script defer src="/assets/js/copy_code.js?d359581efc54b08366f9ef8219e6e511" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?25eff8ff4144a010e4ad7b31403102cf"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>